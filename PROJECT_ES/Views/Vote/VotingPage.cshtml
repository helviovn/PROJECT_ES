@using PROJECT_ES.Data
@inject VoteController voteController
@model PROJECT_ES.ViewModels.VoteViewModel
@{
    ViewData["Title"] = "Voting Page";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick-theme.min.css" />
</head>

<body>
<div class="container">
    <h1>Competição: @Model.Competition.Name</h1>
    <h1>Categoria: @Model.Category.Name</h1>
</div>

<div class="category-slider">
    @foreach (var movie in Model.Movies)
    {
        <div class="category-slide">
            <td><img src="@movie.Image" width="50" height="70" /></td>
            <h3>@movie.Title</h3>
        </div>
    }
</div>
<hr>

<div id="error-message" style="display:none;">Já votaste nesta categoria!!</div>
 
<div id="success-message" style="display:none;">Voto foi inserido com sucesso</div>
    <form id="vote-form" method="post" action="@Url.Action("Vote", "Vote")">
        <input type="hidden" name="competitionId" value="@Model.Competition.Id" />
        <input type="hidden" name="categoryId" value="@Model.Category.Id" />
    
        <div class="form-group">
            <label for="name">Nome:</label>
            <input type="text" class="form-control" id="name" name="name" required>
        </div>
        
        <div class="form-group">
            <label for="email">Email:</label>
            <input type="email" class="form-control" id="email" name="email" required>
        </div>
        
        <div class="form-group">
            <label for="movie-select">Escolha um filme:</label>
            <select class="form-control" id="movie-select" name="movieId" required>
                @foreach (var movie in Model.Movies)
                {
                    <option value="@movie.Id">@movie.Title</option>
                }
            </select>
        </div>
        
        <button type="submit" class="btn btn-primary">Confirmar voto</button>
    </form>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.js"></script>
<script>
        $(document).ready(function() {
            $('.category-slider').slick({
                autoplay: true,
                autoplaySpeed: 5000,
                dots: true,
                slidesToShow: 5, // Show 5 slides at a time
                                slidesToScroll: 5 // Scroll 5 slides at a time
            });
           
           $('#vote-form').on('submit', function(e) {
                   e.preventDefault(); // Prevent the form from submitting normally
           
                   var formData = {
                       competitionId: $('input[name="competitionId"]').val(),
                       categoryId: $('input[name="categoryId"]').val(),
                       name: $('#name').val(),
                       email: $('#email').val(),
                       movieId: $('#movie-select').val()
                   };
           
                   $.post('@Url.Action("Vote", "Vote")', formData, function (response) {
                               if (response.done) {
                                   $('#vote-form').hide();
                                   $('#success-message').show();
                               }
                               else if (response.error) {
                                $('#vote-form').hide();
                                $('#error-message').show();
                               }
               });
               });
               });
           
           </script>
</body>
</html>
